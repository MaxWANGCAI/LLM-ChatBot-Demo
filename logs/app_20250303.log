2025-03-03 00:21:31,093 - qa_app - INFO - 27309 - 4581565952 - 启动服务器...
2025-03-03 00:21:31,093 - qa_app - INFO - 启动服务器...
2025-03-03 00:21:31,093 - __main__ - ERROR - 服务启动失败: 'Settings' object has no attribute 'HOST'
2025-03-03 00:21:31,093 - __main__ - INFO - 服务已完全关闭
2025-03-03 00:23:53,643 - qa_app - INFO - 27387 - 4418885120 - 启动服务器...
2025-03-03 00:23:53,643 - qa_app - INFO - 启动服务器...
2025-03-03 00:23:53,713 - qa_app - INFO - 27387 - 4418885120 - 应用服务启动...
2025-03-03 00:23:53,713 - qa_app - INFO - 应用服务启动...
2025-03-03 00:23:53,713 - qa_app - INFO - 应用服务启动...
2025-03-03 00:23:53,896 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.183s]
2025-03-03 00:23:53,896 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.183s]
2025-03-03 00:23:53,897 - qa_app - INFO - 27387 - 4418885120 - Elasticsearch 连接成功
2025-03-03 00:23:53,897 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:23:53,897 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:23:53,897 - qa_app - INFO - 27387 - 4418885120 - DASHSCOPE_API_KEY 已配置
2025-03-03 00:23:53,897 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:23:53,897 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:23:53,897 - qa_app - INFO - 27387 - 4418885120 - 服务启动成功
2025-03-03 00:23:53,897 - qa_app - INFO - 服务启动成功
2025-03-03 00:23:53,897 - qa_app - INFO - 服务启动成功
2025-03-03 00:31:18,096 - qa_app - INFO - 27500 - 4535035392 - 启动服务器...
2025-03-03 00:31:18,096 - qa_app - INFO - 启动服务器...
2025-03-03 00:31:18,228 - qa_app - INFO - 27500 - 4535035392 - 应用服务启动...
2025-03-03 00:31:18,228 - qa_app - INFO - 应用服务启动...
2025-03-03 00:31:18,228 - qa_app - INFO - 应用服务启动...
2025-03-03 00:31:18,476 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.247s]
2025-03-03 00:31:18,476 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.247s]
2025-03-03 00:31:18,477 - qa_app - INFO - 27500 - 4535035392 - Elasticsearch 连接成功
2025-03-03 00:31:18,477 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:31:18,477 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:31:18,477 - qa_app - INFO - 27500 - 4535035392 - DASHSCOPE_API_KEY 已配置
2025-03-03 00:31:18,477 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:31:18,477 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:31:18,477 - qa_app - INFO - 27500 - 4535035392 - 服务启动成功
2025-03-03 00:31:18,477 - qa_app - INFO - 服务启动成功
2025-03-03 00:31:18,477 - qa_app - INFO - 服务启动成功
2025-03-03 00:37:34,821 - qa_app - INFO - 27620 - 4557428224 - 启动服务器...
2025-03-03 00:37:34,821 - qa_app - INFO - 启动服务器...
2025-03-03 00:37:34,899 - qa_app - INFO - 27620 - 4557428224 - 应用服务启动...
2025-03-03 00:37:34,899 - qa_app - INFO - 应用服务启动...
2025-03-03 00:37:34,899 - qa_app - INFO - 应用服务启动...
2025-03-03 00:37:35,003 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.104s]
2025-03-03 00:37:35,003 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.104s]
2025-03-03 00:37:35,004 - qa_app - INFO - 27620 - 4557428224 - Elasticsearch 连接成功
2025-03-03 00:37:35,004 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:37:35,004 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:37:35,005 - qa_app - INFO - 27620 - 4557428224 - DASHSCOPE_API_KEY 已配置
2025-03-03 00:37:35,005 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:37:35,005 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:37:35,005 - qa_app - INFO - 27620 - 4557428224 - 服务启动成功
2025-03-03 00:37:35,005 - qa_app - INFO - 服务启动成功
2025-03-03 00:37:35,005 - qa_app - INFO - 服务启动成功
2025-03-03 00:37:35,006 - qa_app - INFO - 27620 - 4557428224 - 应用服务关闭...
2025-03-03 00:37:35,006 - qa_app - INFO - 应用服务关闭...
2025-03-03 00:37:35,006 - qa_app - INFO - 应用服务关闭...
2025-03-03 00:37:35,007 - qa_app - INFO - 27620 - 4557428224 - 服务已完全关闭
2025-03-03 00:37:35,007 - qa_app - INFO - 服务已完全关闭
2025-03-03 00:37:35,007 - qa_app - INFO - 服务已完全关闭
2025-03-03 00:37:35,008 - __main__ - INFO - 服务已完全关闭
2025-03-03 00:37:35,008 - __main__ - INFO - 服务已完全关闭
2025-03-03 00:41:28,255 - qa_app - INFO - 27693 - 4332779008 - 启动服务器...
2025-03-03 00:41:28,255 - qa_app - INFO - 启动服务器...
2025-03-03 00:41:28,317 - qa_app - INFO - 27693 - 4332779008 - 应用服务启动...
2025-03-03 00:41:28,317 - qa_app - INFO - 应用服务启动...
2025-03-03 00:41:28,317 - qa_app - INFO - 应用服务启动...
2025-03-03 00:41:28,469 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.152s]
2025-03-03 00:41:28,469 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.152s]
2025-03-03 00:41:28,470 - qa_app - INFO - 27693 - 4332779008 - Elasticsearch 连接成功
2025-03-03 00:41:28,470 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:41:28,470 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:41:28,470 - qa_app - INFO - 27693 - 4332779008 - DASHSCOPE_API_KEY 已配置
2025-03-03 00:41:28,470 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:41:28,470 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:41:28,470 - qa_app - INFO - 27693 - 4332779008 - 服务启动成功
2025-03-03 00:41:28,470 - qa_app - INFO - 服务启动成功
2025-03-03 00:41:28,470 - qa_app - INFO - 服务启动成功
2025-03-03 00:41:28,471 - qa_app - INFO - 27693 - 4332779008 - 应用服务关闭...
2025-03-03 00:41:28,471 - qa_app - INFO - 应用服务关闭...
2025-03-03 00:41:28,471 - qa_app - INFO - 应用服务关闭...
2025-03-03 00:41:28,472 - qa_app - INFO - 27693 - 4332779008 - 服务已完全关闭
2025-03-03 00:41:28,472 - qa_app - INFO - 服务已完全关闭
2025-03-03 00:41:28,472 - qa_app - INFO - 服务已完全关闭
2025-03-03 00:41:28,472 - __main__ - INFO - 服务已完全关闭
2025-03-03 00:41:28,472 - __main__ - INFO - 服务已完全关闭
2025-03-03 00:42:28,487 - qa_app - INFO - 27500 - 4535035392 - 创建新会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 知识库类型: all
2025-03-03 00:42:28,487 - qa_app - INFO - 创建新会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 知识库类型: all
2025-03-03 00:42:28,487 - qa_app - INFO - 创建新会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 知识库类型: all
2025-03-03 00:42:28,680 - qa_app - INFO - 27500 - 4535035392 - 创建新的对话链实例，知识库类型: all
2025-03-03 00:42:28,680 - qa_app - INFO - 创建新的对话链实例，知识库类型: all
2025-03-03 00:42:28,680 - qa_app - INFO - 创建新的对话链实例，知识库类型: all
2025-03-03 00:42:28,681 - qa_app - INFO - 27500 - 4535035392 - 收到问题 - 会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 问题: 大模型有哪些主流架构
2025-03-03 00:42:28,681 - qa_app - INFO - 收到问题 - 会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 问题: 大模型有哪些主流架构
2025-03-03 00:42:28,681 - qa_app - INFO - 收到问题 - 会话: 82d38e8c-b741-4f39-9027-9791ed7746f7, 问题: 大模型有哪些主流架构
2025-03-03 00:42:29,209 - qa_app - ERROR - 27500 - 4535035392 - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T00:42:29.107492", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 00:42:29,209 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T00:42:29.107492", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 00:42:29,209 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T00:42:29.107492", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 00:42:29,442 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 00:42:29,442 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 00:42:29,457 - qa_metrics - INFO - {"timestamp": "2025-03-03T00:42:29.457088", "session_id": "82d38e8c-b741-4f39-9027-9791ed7746f7", "kb_type": "all", "question": "大模型有哪些主流架构", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 1.0251381397247314, "error": null, "metadata": {"token_count": 25, "source_count": 0}}
2025-03-03 00:42:29,457 - qa_metrics - INFO - {"timestamp": "2025-03-03T00:42:29.457088", "session_id": "82d38e8c-b741-4f39-9027-9791ed7746f7", "kb_type": "all", "question": "大模型有哪些主流架构", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 1.0251381397247314, "error": null, "metadata": {"token_count": 25, "source_count": 0}}
2025-03-03 00:45:06,147 - qa_app - INFO - 27787 - 4623549952 - 启动服务器...
2025-03-03 00:45:06,147 - qa_app - INFO - 启动服务器...
2025-03-03 00:45:06,217 - qa_app - INFO - 27787 - 4623549952 - 应用服务启动...
2025-03-03 00:45:06,217 - qa_app - INFO - 应用服务启动...
2025-03-03 00:45:06,217 - qa_app - INFO - 应用服务启动...
2025-03-03 00:45:06,325 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.107s]
2025-03-03 00:45:06,325 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.107s]
2025-03-03 00:45:06,326 - qa_app - INFO - 27787 - 4623549952 - Elasticsearch 连接成功
2025-03-03 00:45:06,326 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:45:06,326 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 00:45:06,326 - qa_app - INFO - 27787 - 4623549952 - DASHSCOPE_API_KEY 已配置
2025-03-03 00:45:06,326 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:45:06,326 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 00:45:06,326 - qa_app - INFO - 27787 - 4623549952 - 服务启动成功
2025-03-03 00:45:06,326 - qa_app - INFO - 服务启动成功
2025-03-03 00:45:06,326 - qa_app - INFO - 服务启动成功
2025-03-03 02:03:32,518 - qa_app - INFO - 29747 - 4694689280 - 启动服务器...
2025-03-03 02:03:32,518 - qa_app - INFO - 启动服务器...
2025-03-03 02:03:32,619 - qa_app - INFO - 29747 - 4694689280 - 应用服务启动...
2025-03-03 02:03:32,619 - qa_app - INFO - 应用服务启动...
2025-03-03 02:03:32,619 - qa_app - INFO - 应用服务启动...
2025-03-03 02:03:32,634 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.014s]
2025-03-03 02:03:32,634 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.014s]
2025-03-03 02:03:32,635 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 1 times in a row, putting on 1 second timeout
2025-03-03 02:03:32,635 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 1 times in a row, putting on 1 second timeout
2025-03-03 02:03:32,635 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 0 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,635 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 0 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,782 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,782 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,783 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 2 times in a row, putting on 2 second timeout
2025-03-03 02:03:32,783 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 2 times in a row, putting on 2 second timeout
2025-03-03 02:03:32,783 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 1 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6280>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6280>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,783 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 1 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6280>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6280>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,786 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,786 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,786 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 3 times in a row, putting on 4 second timeout
2025-03-03 02:03:32,786 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 3 times in a row, putting on 4 second timeout
2025-03-03 02:03:32,787 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 2 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6580>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6580>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,787 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 2 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x10c9e6580>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6580>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:03:32,790 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,790 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:03:32,790 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 4 times in a row, putting on 8 second timeout
2025-03-03 02:03:32,790 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 4 times in a row, putting on 8 second timeout
2025-03-03 02:03:32,791 - app.utils.es_client - ERROR - Elasticsearch连接测试失败: Connection error caused by: ConnectionError(Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused))
2025-03-03 02:03:32,791 - app.utils.es_client - ERROR - Elasticsearch连接测试失败: Connection error caused by: ConnectionError(Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x10c9e6040>: Failed to establish a new connection: [Errno 61] Connection refused))
2025-03-03 02:03:32,905 - qa_app - ERROR - 29747 - 4694689280 - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:03:32.791208", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:03:32,905 - qa_app - ERROR - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:03:32.791208", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:03:32,905 - qa_app - ERROR - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:03:32.791208", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:03:32,908 - __main__ - ERROR - 服务启动失败: An asyncio.Future, a coroutine or an awaitable is required
2025-03-03 02:03:32,908 - __main__ - ERROR - 服务启动失败: An asyncio.Future, a coroutine or an awaitable is required
2025-03-03 02:03:32,908 - __main__ - INFO - 服务已完全关闭
2025-03-03 02:03:32,908 - __main__ - INFO - 服务已完全关闭
2025-03-03 02:08:24,157 - qa_app - INFO - 29801 - 4730709504 - 启动服务器...
2025-03-03 02:08:24,157 - qa_app - INFO - 启动服务器...
2025-03-03 02:08:24,357 - qa_app - INFO - 29801 - 4730709504 - 应用服务启动...
2025-03-03 02:08:24,357 - qa_app - INFO - 应用服务启动...
2025-03-03 02:08:24,357 - qa_app - INFO - 应用服务启动...
2025-03-03 02:08:24,361 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.003s]
2025-03-03 02:08:24,361 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.003s]
2025-03-03 02:08:24,361 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 1 times in a row, putting on 1 second timeout
2025-03-03 02:08:24,361 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 1 times in a row, putting on 1 second timeout
2025-03-03 02:08:24,361 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 0 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,361 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 0 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,453 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,453 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,453 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 2 times in a row, putting on 2 second timeout
2025-03-03 02:08:24,453 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 2 times in a row, putting on 2 second timeout
2025-03-03 02:08:24,453 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 1 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112b09250>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112b09250>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,453 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 1 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112b09250>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112b09250>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,457 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,457 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,457 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 3 times in a row, putting on 4 second timeout
2025-03-03 02:08:24,457 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 3 times in a row, putting on 4 second timeout
2025-03-03 02:08:24,457 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 2 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112b09550>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112b09550>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,457 - elastic_transport.transport - WARNING - Retrying request after failure (attempt 2 of 3)
Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 167, in perform_request
    response = self.pool.urlopen(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/retry.py", line 449, in increment
    raise reraise(type(error), error, _stacktrace)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 445, in request
    self.endheaders()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 276, in connect
    self.sock = self._new_conn()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x112b09550>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_transport.py", line 342, in perform_request
    resp = node.perform_request(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/elastic_transport/_node/_http_urllib3.py", line 202, in perform_request
    raise err from e
elastic_transport.ConnectionError: Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112b09550>: Failed to establish a new connection: [Errno 61] Connection refused)
2025-03-03 02:08:24,461 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,461 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:N/A duration:0.002s]
2025-03-03 02:08:24,461 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 4 times in a row, putting on 8 second timeout
2025-03-03 02:08:24,461 - elastic_transport.node_pool - WARNING - Node <Urllib3HttpNode(http://localhost:9200)> has failed for 4 times in a row, putting on 8 second timeout
2025-03-03 02:08:24,461 - app.utils.es_client - ERROR - Elasticsearch连接测试失败: Connection error caused by: ConnectionError(Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused))
2025-03-03 02:08:24,461 - app.utils.es_client - ERROR - Elasticsearch连接测试失败: Connection error caused by: ConnectionError(Connection error caused by: NewConnectionError(<urllib3.connection.HTTPConnection object at 0x112afdfd0>: Failed to establish a new connection: [Errno 61] Connection refused))
2025-03-03 02:08:24,596 - qa_app - ERROR - 29801 - 4730709504 - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:08:24.461917", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:08:24,596 - qa_app - ERROR - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:08:24.461917", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:08:24,596 - qa_app - ERROR - {"error_message": "Elasticsearch 连接失败", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T02:08:24.461917", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py\", line 86, in main\n    await app(scope, self.receive, self.send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 29, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 152, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 77, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 48, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 723, in app\n    await self.lifespan(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 692, in lifespan\n    async with self.lifespan_context(app) as maybe_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py\", line 181, in __aenter__\n    return await self.gen.__anext__()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 133, in merged_lifespan\n    async with original_context(app) as maybe_original_state:\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 569, in __aenter__\n    await self._router.startup()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 669, in startup\n    await handler()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 91, in startup_db_client\n    qa_logger.log_error(\"Elasticsearch 连接失败\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 86, in main
    await app(scope, self.receive, self.send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 29, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 152, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 48, in __call__
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 723, in app
    await self.lifespan(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/contextlib.py", line 181, in __aenter__
    return await self.gen.__anext__()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 569, in __aenter__
    await self._router.startup()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 669, in startup
    await handler()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 91, in startup_db_client
    qa_logger.log_error("Elasticsearch 连接失败")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 02:08:24,598 - __main__ - ERROR - 服务启动失败: An asyncio.Future, a coroutine or an awaitable is required
2025-03-03 02:08:24,598 - __main__ - ERROR - 服务启动失败: An asyncio.Future, a coroutine or an awaitable is required
2025-03-03 02:08:24,599 - __main__ - INFO - 服务已完全关闭
2025-03-03 02:08:24,599 - __main__ - INFO - 服务已完全关闭
2025-03-03 03:40:10,887 - qa_app - INFO - 36174 - 4477654528 - 启动服务器...
2025-03-03 03:40:10,887 - qa_app - INFO - 启动服务器...
2025-03-03 03:40:10,965 - qa_app - INFO - 36174 - 4477654528 - 应用服务启动...
2025-03-03 03:40:10,965 - qa_app - INFO - 应用服务启动...
2025-03-03 03:40:10,965 - qa_app - INFO - 应用服务启动...
2025-03-03 03:40:12,570 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:1.605s]
2025-03-03 03:40:12,570 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:1.605s]
2025-03-03 03:40:12,571 - qa_app - INFO - 36174 - 4477654528 - Elasticsearch 连接成功
2025-03-03 03:40:12,571 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 03:40:12,571 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 03:40:12,571 - qa_app - INFO - 36174 - 4477654528 - DASHSCOPE_API_KEY 已配置
2025-03-03 03:40:12,571 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 03:40:12,571 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 03:40:12,571 - qa_app - INFO - 36174 - 4477654528 - 服务启动成功
2025-03-03 03:40:12,571 - qa_app - INFO - 服务启动成功
2025-03-03 03:40:12,571 - qa_app - INFO - 服务启动成功
2025-03-03 03:41:19,079 - qa_app - INFO - 36174 - 4477654528 - 创建新会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 知识库类型: legal
2025-03-03 03:41:19,079 - qa_app - INFO - 创建新会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 知识库类型: legal
2025-03-03 03:41:19,079 - qa_app - INFO - 创建新会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 知识库类型: legal
2025-03-03 03:41:19,093 - qa_app - INFO - 36174 - 4477654528 - 创建新的对话链实例，知识库类型: legal
2025-03-03 03:41:19,093 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-03 03:41:19,093 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-03 03:41:19,094 - qa_app - INFO - 36174 - 4477654528 - 收到问题 - 会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 问题: 你好，介绍下你自己？
2025-03-03 03:41:19,094 - qa_app - INFO - 收到问题 - 会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 问题: 你好，介绍下你自己？
2025-03-03 03:41:19,094 - qa_app - INFO - 收到问题 - 会话: a732d90f-dd8c-4b4c-9194-1cd0f8b4745b, 问题: 你好，介绍下你自己？
2025-03-03 03:41:19,629 - qa_app - ERROR - 36174 - 4477654528 - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:41:19.515868", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:41:19,629 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:41:19.515868", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:41:19,629 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:41:19.515868", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:41:19,790 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 03:41:19,790 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 03:41:19,801 - qa_metrics - INFO - {"timestamp": "2025-03-03T03:41:19.801200", "session_id": "a732d90f-dd8c-4b4c-9194-1cd0f8b4745b", "kb_type": "legal", "question": "你好，介绍下你自己？", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 0.7217369079589844, "error": null, "metadata": {"token_count": 25, "source_count": 0}}
2025-03-03 03:41:19,801 - qa_metrics - INFO - {"timestamp": "2025-03-03T03:41:19.801200", "session_id": "a732d90f-dd8c-4b4c-9194-1cd0f8b4745b", "kb_type": "legal", "question": "你好，介绍下你自己？", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 0.7217369079589844, "error": null, "metadata": {"token_count": 25, "source_count": 0}}
2025-03-03 03:52:40,892 - qa_app - INFO - 36770 - 4579243520 - 启动服务器...
2025-03-03 03:52:40,892 - qa_app - INFO - 启动服务器...
2025-03-03 03:52:41,082 - qa_app - INFO - 36770 - 4579243520 - 应用服务启动...
2025-03-03 03:52:41,082 - qa_app - INFO - 应用服务启动...
2025-03-03 03:52:41,082 - qa_app - INFO - 应用服务启动...
2025-03-03 03:52:41,094 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.011s]
2025-03-03 03:52:41,094 - elastic_transport.transport - INFO - GET http://localhost:9200/ [status:200 duration:0.011s]
2025-03-03 03:52:41,094 - qa_app - INFO - 36770 - 4579243520 - Elasticsearch 连接成功
2025-03-03 03:52:41,094 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 03:52:41,094 - qa_app - INFO - Elasticsearch 连接成功
2025-03-03 03:52:41,094 - qa_app - INFO - 36770 - 4579243520 - DASHSCOPE_API_KEY 已配置
2025-03-03 03:52:41,094 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 03:52:41,094 - qa_app - INFO - DASHSCOPE_API_KEY 已配置
2025-03-03 03:52:41,095 - qa_app - INFO - 36770 - 4579243520 - 服务启动成功
2025-03-03 03:52:41,095 - qa_app - INFO - 服务启动成功
2025-03-03 03:52:41,095 - qa_app - INFO - 服务启动成功
2025-03-03 03:53:17,878 - qa_app - INFO - 36770 - 4579243520 - 创建新会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 知识库类型: all
2025-03-03 03:53:17,878 - qa_app - INFO - 创建新会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 知识库类型: all
2025-03-03 03:53:17,878 - qa_app - INFO - 创建新会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 知识库类型: all
2025-03-03 03:53:17,892 - qa_app - INFO - 36770 - 4579243520 - 创建新的对话链实例，知识库类型: all
2025-03-03 03:53:17,892 - qa_app - INFO - 创建新的对话链实例，知识库类型: all
2025-03-03 03:53:17,892 - qa_app - INFO - 创建新的对话链实例，知识库类型: all
2025-03-03 03:53:17,892 - qa_app - INFO - 36770 - 4579243520 - 收到问题 - 会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 问题: 介绍下你自己？
2025-03-03 03:53:17,892 - qa_app - INFO - 收到问题 - 会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 问题: 介绍下你自己？
2025-03-03 03:53:17,892 - qa_app - INFO - 收到问题 - 会话: 0bd6809a-5755-4a7b-a089-80b2afc4ba27, 问题: 介绍下你自己？
2025-03-03 03:53:18,236 - qa_app - ERROR - 36770 - 4579243520 - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:53:18.151792", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:53:18,236 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:53:18.151792", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:53:18,236 - qa_app - ERROR - {"error_message": "获取 embedding 失败: Invalid API-key provided.", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-03T03:53:18.151792", "traceback": "NoneType: None\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 170, in <module>\n    main()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py\", line 157, in main\n    loop.run_until_complete(server.run())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py\", line 66, in run\n    return asyncio.run(self.serve(sockets=sockets))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py\", line 403, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py\", line 112, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py\", line 43, in chat\n    response = await chain.get_response(request.question)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 161, in get_response\n    response = await self.chain.ainvoke({\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py\", line 212, in ainvoke\n    await self._acall(inputs, run_manager=run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 211, in _acall\n    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py\", line 409, in _aget_docs\n    docs = await self.retriever.ainvoke(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py\", line 326, in ainvoke\n    result = await self._aget_relevant_documents(input, **_kwargs)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 70, in aget_relevant_documents\n    qa_logger.log_error(f\"获取 embedding 失败: {response.message}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 184, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
NoneType: None
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 170, in <module>
    main()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/main.py", line 157, in main
    loop.run_until_complete(server.run())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/api/routers/chat.py", line 43, in chat
    response = await chain.get_response(request.question)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 161, in get_response
    response = await self.chain.ainvoke({
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/base.py", line 212, in ainvoke
    await self._acall(inputs, run_manager=run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 211, in _acall
    docs = await self._aget_docs(new_question, inputs, run_manager=_run_manager)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain/chains/conversational_retrieval/base.py", line 409, in _aget_docs
    docs = await self.retriever.ainvoke(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/retrievers.py", line 326, in ainvoke
    result = await self._aget_relevant_documents(input, **_kwargs)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 70, in aget_relevant_documents
    qa_logger.log_error(f"获取 embedding 失败: {response.message}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 186, in log_error
    self.app_logger.error(
2025-03-03 03:53:18,444 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 03:53:18,444 - app.utils.aliyun_llm - ERROR - Error from Aliyun API: Invalid API-key provided.
2025-03-03 03:53:18,467 - qa_metrics - INFO - {"timestamp": "2025-03-03T03:53:18.466980", "session_id": "0bd6809a-5755-4a7b-a089-80b2afc4ba27", "kb_type": "all", "question": "介绍下你自己？", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 0.5884959697723389, "error": null, "metadata": {"token_count": 22, "source_count": 0}}
2025-03-03 03:53:18,467 - qa_metrics - INFO - {"timestamp": "2025-03-03T03:53:18.466980", "session_id": "0bd6809a-5755-4a7b-a089-80b2afc4ba27", "kb_type": "all", "question": "介绍下你自己？", "answer": "抱歉，处理您的请求时出现错误。", "sources": [], "response_time": 0.5884959697723389, "error": null, "metadata": {"token_count": 22, "source_count": 0}}
