2025-03-02 03:05:56,507 - qa_app - INFO - 开始执行测试类别: 基础对话测试
2025-03-02 03:05:56,509 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:05:58,406 - qa_app - INFO - 文档检索完成 - 总耗时: 1.90秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:05:59,224 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:05:59,644 - qa_app - INFO - 文档检索完成 - 总耗时: 0.42秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:06:00,896 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:06:01,688 - qa_app - INFO - 文档检索完成 - 总耗时: 0.79秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:06:02,903 - qa_app - INFO - 开始执行测试类别: 法律助手测试
2025-03-02 03:06:02,904 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-02 03:06:03,274 - qa_app - INFO - 文档检索完成 - 总耗时: 0.37秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 03:06:04,753 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-02 03:06:05,111 - qa_app - INFO - 文档检索完成 - 总耗时: 0.36秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 03:06:07,210 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-02 03:06:07,573 - qa_app - INFO - 文档检索完成 - 总耗时: 0.36秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 03:06:09,553 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-02 03:06:09,774 - qa_app - INFO - 文档检索完成 - 总耗时: 0.22秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 03:06:11,715 - qa_app - INFO - 开始执行测试类别: 商业助手测试
2025-03-02 03:06:11,715 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:12,088 - qa_app - INFO - 文档检索完成 - 总耗时: 0.37秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:15,299 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:15,575 - qa_app - INFO - 文档检索完成 - 总耗时: 0.28秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:20,216 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:20,647 - qa_app - INFO - 文档检索完成 - 总耗时: 0.43秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:22,553 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:23,036 - qa_app - INFO - 文档检索完成 - 总耗时: 0.48秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:25,745 - qa_app - INFO - 开始执行测试类别: 客服助手测试
2025-03-02 03:06:25,746 - qa_app - INFO - 创建新的对话链实例，知识库类型: customer
2025-03-02 03:06:26,160 - qa_app - INFO - 文档检索完成 - 总耗时: 0.41秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 03:06:27,078 - qa_app - INFO - 创建新的对话链实例，知识库类型: customer
2025-03-02 03:06:27,495 - qa_app - INFO - 文档检索完成 - 总耗时: 0.42秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 03:06:29,199 - qa_app - INFO - 创建新的对话链实例，知识库类型: customer
2025-03-02 03:06:29,449 - qa_app - INFO - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 03:06:30,251 - qa_app - INFO - 创建新的对话链实例，知识库类型: customer
2025-03-02 03:06:30,503 - qa_app - INFO - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 03:06:31,079 - qa_app - INFO - 开始执行测试类别: 上下文连续对话测试
2025-03-02 03:06:31,080 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:31,342 - qa_app - INFO - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:34,371 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:34,630 - qa_app - INFO - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:35,332 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:06:35,742 - qa_app - INFO - 文档检索完成 - 总耗时: 0.41秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:06:36,804 - qa_app - INFO - 开始执行测试类别: 边界测试
2025-03-02 03:06:36,805 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:06:37,218 - qa_app - INFO - 文档检索完成 - 总耗时: 0.41秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:06:38,031 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:06:38,387 - qa_app - INFO - 文档检索完成 - 总耗时: 0.36秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:06:39,018 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:06:39,417 - qa_app - INFO - 文档检索完成 - 总耗时: 0.40秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:06:45,352 - qa_app - INFO - 测试报告已生成: test_reports/qa_test_report_20250302_030640.html
2025-03-02 03:08:57,941 - qa_app - INFO - 开始执行测试类别: 基础对话测试
2025-03-02 03:08:57,943 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:08:58,278 - qa_app - INFO - 文档检索完成 - 总耗时: 0.33秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:08:58,815 - qa_app - INFO - 测试用例完成 - 类别: 基础对话测试, 问题: 你好, 状态: failed
2025-03-02 03:08:58,815 - qa_app - WARNING - 测试用例未通过 - 错误: None, 验证结果: {'passed': False, 'checks': [{'rule': 'keywords', 'passed': False, 'message': '缺少关键词: 您好, 欢迎'}], 'is_critical': False}
2025-03-02 03:08:58,815 - qa_app - INFO - 创建新的对话链实例，知识库类型: general
2025-03-02 03:08:59,165 - qa_app - INFO - 文档检索完成 - 总耗时: 0.35秒, 找到文档数: 0, 知识库类型: general
2025-03-02 03:09:00,266 - qa_app - INFO - 测试用例完成 - 类别: 基础对话测试, 问题: 请介绍一下你自己, 状态: failed
2025-03-02 03:09:00,266 - qa_app - WARNING - 测试用例未通过 - 错误: None, 验证结果: {'passed': False, 'checks': [{'rule': 'keywords', 'passed': False, 'message': '缺少关键词: 服务'}], 'is_critical': False}
2025-03-02 03:09:00,267 - qa_app - INFO - 开始执行测试类别: 法律助手测试
2025-03-02 03:09:00,267 - qa_app - INFO - 创建新的对话链实例，知识库类型: legal
2025-03-02 03:09:00,541 - qa_app - INFO - 文档检索完成 - 总耗时: 0.27秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 03:09:02,112 - qa_app - INFO - 测试用例完成 - 类别: 法律助手测试, 问题: 什么是知识产权保护？, 状态: success
2025-03-02 03:09:02,112 - qa_app - INFO - 开始执行测试类别: 商业助手测试
2025-03-02 03:09:02,112 - qa_app - INFO - 创建新的对话链实例，知识库类型: business
2025-03-02 03:09:02,362 - qa_app - INFO - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: business
2025-03-02 03:09:05,385 - qa_app - INFO - 测试用例完成 - 类别: 商业助手测试, 问题: 如何制定有效的营销策略？, 状态: success
2025-03-02 03:09:06,681 - qa_app - INFO - 测试报告已生成: test_reports/qa_test_report_20250302_030905.html
2025-03-02 15:46:32,758 - qa_app - ERROR - 58551 - 4539115008 - {"error_message": "基础检查失败: Elasticsearch 服务不可用", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T15:46:32.699200", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 353, in run_all_tests\n    self.basic_checks()\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 328, in basic_checks\n    raise Exception(\"Elasticsearch 服务不可用\")\nException: Elasticsearch 服务不可用\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 585, in <module>\n    asyncio.run(main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py\", line 44, in run\n    return loop.run_until_complete(main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 580, in main\n    await runner.run_all_tests()\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 355, in run_all_tests\n    qa_logger.log_error(f\"基础检查失败: {e}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 353, in run_all_tests
    self.basic_checks()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 328, in basic_checks
    raise Exception("Elasticsearch 服务不可用")
Exception: Elasticsearch 服务不可用
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 585, in <module>
    asyncio.run(main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 580, in main
    await runner.run_all_tests()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 355, in run_all_tests
    qa_logger.log_error(f"基础检查失败: {e}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:41:45,822 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:41:45,835 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 火星上的重力是多少？
2025-03-02 19:41:49,624 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 3.77秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:41:51,365 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 未知信息测试, 问题: 火星上的重力是多少？
2025-03-02 19:41:51,365 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 无法, 信息, 不足"}], "is_critical": false}
2025-03-02 19:41:51,366 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:41:51,366 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 公司2030年的发展规划是什么？
2025-03-02 19:41:51,646 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.28秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:41:52,432 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 未知信息测试, 问题: 公司2030年的发展规划是什么？
2025-03-02 19:41:52,432 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 不足"}], "is_critical": false}
2025-03-02 19:41:52,432 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:41:52,432 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 未来五年的法律法规变化趋势如何？
2025-03-02 19:41:52,707 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.27秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:41:54,010 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 未知信息测试, 问题: 未来五年的法律法规变化趋势如何？
2025-03-02 19:41:54,010 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 无法, 不足"}], "is_critical": false}
2025-03-02 19:41:54,011 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:41:54,011 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 你好
2025-03-02 19:41:54,404 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.39秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:41:54,863 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 基础对话测试, 问题: 你好
2025-03-02 19:41:54,864 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 您好, 欢迎"}], "is_critical": false}
2025-03-02 19:41:54,864 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:41:54,864 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 请介绍一下你自己
2025-03-02 19:41:55,186 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.32秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:41:55,984 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 基础对话测试, 问题: 请介绍一下你自己
2025-03-02 19:41:55,984 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 助手, 帮助, 服务"}], "is_critical": false}
2025-03-02 19:41:55,984 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:41:55,985 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 你能帮我做什么
2025-03-02 19:41:56,235 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:41:57,526 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 基础对话测试, 问题: 你能帮我做什么
2025-03-02 19:41:57,528 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 解答, 服务"}], "is_critical": false}
2025-03-02 19:41:57,529 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:41:57,529 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 退货政策是什么？
2025-03-02 19:41:57,779 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:41:59,119 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 客服助手测试, 问题: 退货政策是什么？
2025-03-02 19:41:59,120 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 退换货, 7天, 质量问题, 运费, 商家承担"}], "is_critical": false}
2025-03-02 19:41:59,120 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:41:59,120 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 配送需要多长时间？
2025-03-02 19:41:59,366 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:41:59,941 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 客服助手测试, 问题: 配送需要多长时间？
2025-03-02 19:41:59,941 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "expected_min_length", "passed": false, "message": "回答长度不满足预期最小长度 30"}, {"rule": "keywords", "passed": false, "message": "缺少关键词: 配送时效, 24小时, 发货, 偏远地区, 48-72小时"}], "is_critical": false}
2025-03-02 19:41:59,942 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:41:59,942 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 退货流程是怎样的？
2025-03-02 19:42:00,247 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.30秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:42:00,981 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 客服助手测试, 问题: 退货流程是怎样的？
2025-03-02 19:42:00,981 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 退货申请, 客服审核, 退货地址, 验收, 退款处理"}], "is_critical": false}
2025-03-02 19:42:00,982 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:42:00,982 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 如何修改收货地址？
2025-03-02 19:42:01,255 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.27秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:42:02,553 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 客服助手测试, 问题: 如何修改收货地址？
2025-03-02 19:42:02,553 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 修改"}], "is_critical": false}
2025-03-02 19:42:02,553 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:42:02,553 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 商品质量问题如何投诉？
2025-03-02 19:42:02,796 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.24秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:42:06,435 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 客服助手测试, 问题: 商品质量问题如何投诉？
2025-03-02 19:42:06,435 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 客服, 处理流程"}], "is_critical": false}
2025-03-02 19:42:06,436 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:42:06,436 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 什么是知识产权保护？
2025-03-02 19:42:06,691 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:42:07,847 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:42:07,847 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 合同审批流程是怎样的？
2025-03-02 19:42:08,121 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.27秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:42:11,077 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:42:11,077 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 如何处理商标侵权问题？
2025-03-02 19:42:11,467 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.39秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:42:22,367 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 法律助手测试, 问题: 如何处理商标侵权问题？
2025-03-02 19:42:22,368 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "max_response_time", "passed": false, "message": "响应时间超过 10 秒"}, {"rule": "keywords", "passed": false, "message": "缺少关键词: 维权"}], "is_critical": false}
2025-03-02 19:42:22,368 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:42:22,368 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 数据安全合规要求有哪些？
2025-03-02 19:42:22,635 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.27秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:42:25,239 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 法律助手测试, 问题: 数据安全合规要求有哪些？
2025-03-02 19:42:25,239 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 隐私"}], "is_critical": false}
2025-03-02 19:42:25,240 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:42:25,240 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 如何制定有效的营销策略？
2025-03-02 19:42:25,496 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:42:28,092 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:42:28,092 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 品类知识库的主要功能是什么？
2025-03-02 19:42:28,345 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:42:29,622 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 商业助手测试, 问题: 品类知识库的主要功能是什么？
2025-03-02 19:42:29,622 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 特征指标, 共创"}], "is_critical": false}
2025-03-02 19:42:29,623 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:42:29,623 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 如何评估新项目的可行性？
2025-03-02 19:42:29,860 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.24秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:42:32,538 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 商业助手测试, 问题: 如何评估新项目的可行性？
2025-03-02 19:42:32,538 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 收益"}], "is_critical": false}
2025-03-02 19:42:32,538 - qa_app - INFO - 17596 - 4561176064 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:42:32,538 - qa_app - INFO - 17596 - 4561176064 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 业务流程审批需要哪些材料？
2025-03-02 19:42:32,932 - qa_app - INFO - 17596 - 4561176064 - 文档检索完成 - 总耗时: 0.39秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:42:35,123 - qa_app - WARNING - 17596 - 4561176064 - 测试验证失败 - 类别: 商业助手测试, 问题: 业务流程审批需要哪些材料？
2025-03-02 19:42:35,123 - qa_app - WARNING - 17596 - 4561176064 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 表单"}], "is_critical": false}
2025-03-02 19:42:35,360 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.237491", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,361 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.360830", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,362 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.362089", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,363 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.363186", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,366 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.364371", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,367 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.366792", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,368 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.368109", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,370 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.369476", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,371 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.371131", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,373 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.372346", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,374 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.373568", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,375 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.374655", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,376 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.375818", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,377 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.376877", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,378 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.378213", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,380 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.379339", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,381 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.380538", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,383 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.382768", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,385 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.384256", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:42:35,386 - qa_app - ERROR - 17596 - 4561176064 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:42:35.385589", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:47:32,944 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:47:32,962 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 火星上的重力是多少？
2025-03-02 19:47:33,416 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.45秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:47:34,620 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 未知信息测试, 问题: 火星上的重力是多少？
2025-03-02 19:47:34,621 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 无法, 信息, 不足"}], "is_critical": false}
2025-03-02 19:47:34,621 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:47:34,621 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 公司2030年的发展规划是什么？
2025-03-02 19:47:34,878 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:47:35,636 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 未知信息测试, 问题: 公司2030年的发展规划是什么？
2025-03-02 19:47:35,636 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 无法, 信息, 不足"}], "is_critical": false}
2025-03-02 19:47:35,637 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:47:35,637 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 未知信息测试, 问题: 未来五年的法律法规变化趋势如何？
2025-03-02 19:47:36,149 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.51秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:47:37,498 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 未知信息测试, 问题: 未来五年的法律法规变化趋势如何？
2025-03-02 19:47:37,498 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 抱歉, 无法, 不足"}], "is_critical": false}
2025-03-02 19:47:37,499 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:47:37,499 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 你好
2025-03-02 19:47:37,805 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.31秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:47:38,385 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 基础对话测试, 问题: 你好
2025-03-02 19:47:38,386 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 您好, 欢迎"}], "is_critical": false}
2025-03-02 19:47:38,386 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:47:38,386 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 请介绍一下你自己
2025-03-02 19:47:38,619 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.23秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:47:39,345 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 基础对话测试, 问题: 请介绍一下你自己
2025-03-02 19:47:39,346 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 助手, 帮助, 服务"}], "is_critical": false}
2025-03-02 19:47:39,346 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: general
2025-03-02 19:47:39,346 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 基础对话测试, 问题: 你能帮我做什么
2025-03-02 19:47:39,686 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.34秒, 找到文档数: 0, 知识库类型: general
2025-03-02 19:47:40,371 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 基础对话测试, 问题: 你能帮我做什么
2025-03-02 19:47:40,371 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 解答, 服务"}], "is_critical": false}
2025-03-02 19:47:40,371 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:47:40,372 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 退货政策是什么？
2025-03-02 19:47:40,697 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.32秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:47:41,838 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 客服助手测试, 问题: 退货政策是什么？
2025-03-02 19:47:41,838 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 退换货, 7天, 质量问题, 运费, 商家承担"}], "is_critical": false}
2025-03-02 19:47:41,838 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:47:41,838 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 配送需要多长时间？
2025-03-02 19:47:42,086 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.25秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:47:42,830 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 客服助手测试, 问题: 配送需要多长时间？
2025-03-02 19:47:42,830 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "expected_min_length", "passed": false, "message": "回答长度不满足预期最小长度 30"}, {"rule": "keywords", "passed": false, "message": "缺少关键词: 配送时效, 24小时, 发货, 偏远地区, 48-72小时"}], "is_critical": false}
2025-03-02 19:47:42,831 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:47:42,831 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 退货流程是怎样的？
2025-03-02 19:47:43,055 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.22秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:47:44,043 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 客服助手测试, 问题: 退货流程是怎样的？
2025-03-02 19:47:44,043 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 退货申请, 客服审核, 退货地址, 验收, 退款处理"}], "is_critical": false}
2025-03-02 19:47:44,044 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:47:44,044 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 如何修改收货地址？
2025-03-02 19:47:44,282 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.24秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:47:45,353 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: customer
2025-03-02 19:47:45,353 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 客服助手测试, 问题: 商品质量问题如何投诉？
2025-03-02 19:47:45,582 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.23秒, 找到文档数: 0, 知识库类型: customer
2025-03-02 19:47:47,525 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 客服助手测试, 问题: 商品质量问题如何投诉？
2025-03-02 19:47:47,525 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 客服, 凭证, 处理流程"}], "is_critical": false}
2025-03-02 19:47:47,525 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:47:47,525 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 什么是知识产权保护？
2025-03-02 19:47:47,770 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.24秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:47:48,996 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:47:48,997 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 合同审批流程是怎样的？
2025-03-02 19:47:49,254 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:47:52,058 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:47:52,058 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 如何处理商标侵权问题？
2025-03-02 19:47:52,299 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.24秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:48:02,164 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 法律助手测试, 问题: 如何处理商标侵权问题？
2025-03-02 19:48:02,164 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "max_response_time", "passed": false, "message": "响应时间超过 10 秒"}, {"rule": "keywords", "passed": false, "message": "缺少关键词: 维权"}], "is_critical": false}
2025-03-02 19:48:02,164 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: legal
2025-03-02 19:48:02,165 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 法律助手测试, 问题: 数据安全合规要求有哪些？
2025-03-02 19:48:02,385 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.22秒, 找到文档数: 0, 知识库类型: legal
2025-03-02 19:48:05,267 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:48:05,267 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 如何制定有效的营销策略？
2025-03-02 19:48:05,625 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.36秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:48:07,432 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:48:07,433 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 品类知识库的主要功能是什么？
2025-03-02 19:48:07,692 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.26秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:48:09,545 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 商业助手测试, 问题: 品类知识库的主要功能是什么？
2025-03-02 19:48:09,545 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 特征指标, 共创"}], "is_critical": false}
2025-03-02 19:48:09,546 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:48:09,546 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 如何评估新项目的可行性？
2025-03-02 19:48:09,914 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.37秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:48:12,893 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 商业助手测试, 问题: 如何评估新项目的可行性？
2025-03-02 19:48:12,893 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 收益"}], "is_critical": false}
2025-03-02 19:48:12,893 - qa_app - INFO - 18151 - 4607174144 - 创建新的对话链实例，知识库类型: business
2025-03-02 19:48:12,893 - qa_app - INFO - 18151 - 4607174144 - 开始执行测试用例 - 类别: 商业助手测试, 问题: 业务流程审批需要哪些材料？
2025-03-02 19:48:13,264 - qa_app - INFO - 18151 - 4607174144 - 文档检索完成 - 总耗时: 0.37秒, 找到文档数: 0, 知识库类型: business
2025-03-02 19:48:15,785 - qa_app - WARNING - 18151 - 4607174144 - 测试验证失败 - 类别: 商业助手测试, 问题: 业务流程审批需要哪些材料？
2025-03-02 19:48:15,785 - qa_app - WARNING - 18151 - 4607174144 - 验证结果: {"passed": false, "checks": [{"rule": "keywords", "passed": false, "message": "缺少关键词: 文档, 表单"}], "is_critical": false}
2025-03-02 19:48:15,907 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.795381", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,908 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.907572", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,909 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.908860", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,910 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.910193", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,912 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.911408", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,913 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.912477", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,914 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.913693", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,915 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.914876", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,916 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.916132", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,917 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.917241", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,919 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.918490", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,922 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.919623", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,923 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.922973", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,924 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.924143", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,926 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.925446", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,927 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.926601", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,928 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.927810", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,929 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.928893", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['customer', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,930 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "测试用例执行失败: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.930100", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 537, in run_test_case\n    qa_logger.log_error(f\"测试用例执行失败: {error_msg}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 537, in run_test_case
    qa_logger.log_error(f"测试用例执行失败: {error_msg}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 19:48:15,931 - qa_app - ERROR - 18151 - 4607174144 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T19:48:15.931189", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 482, in run_test_case\n    chain = ConversationChain(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 138, in __init__\n    self.retriever = CustomRetriever(kb_type=kb_type)\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py\", line 24, in __init__\n    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py\", line 125, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\npydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever\nkb_type\n  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 72, in test_qa_system\n    result = await self.run_test_case(case, category, \"test_session\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 538, in run_test_case\n    qa_logger.log_error(f\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 482, in run_test_case
    chain = ConversationChain(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 138, in __init__
    self.retriever = CustomRetriever(kb_type=kb_type)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/core/chains/conversation_chain.py", line 24, in __init__
    super().__init__(kb_type=kb_type, index_name=index_name, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/langchain_core/load/serializable.py", line 125, in __init__
    super().__init__(*args, **kwargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CustomRetriever
kb_type
  Input should be a valid string [type=string_type, input_value=['business', 'legal'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 72, in test_qa_system
    result = await self.run_test_case(case, category, "test_session")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 538, in run_test_case
    qa_logger.log_error(f"异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 22:51:03,510 - qa_app - ERROR - 25521 - 4544120320 - {"error_message": "测试执行失败: Elasticsearch 服务不可用", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T22:51:03.447701", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 69, in test_qa_system\n    self.basic_checks()\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 601, in basic_checks\n    raise Exception(\"Elasticsearch 服务不可用\")\nException: Elasticsearch 服务不可用\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 106, in test_qa_system\n    qa_logger.log_error(f\"测试执行失败: {str(e)}\")\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 69, in test_qa_system
    self.basic_checks()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 601, in basic_checks
    raise Exception("Elasticsearch 服务不可用")
Exception: Elasticsearch 服务不可用
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 106, in test_qa_system
    qa_logger.log_error(f"测试执行失败: {str(e)}")
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
2025-03-02 22:51:03,512 - qa_app - ERROR - 25521 - 4544120320 - {"error_message": "异常堆栈信息:", "python_version": "3.9.21 (main, Dec 11 2024, 10:23:52) \n[Clang 14.0.6 ]", "timestamp": "2025-03-02T22:51:03.511598", "traceback": "Traceback (most recent call last):\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 69, in test_qa_system\n    self.basic_checks()\n  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 601, in basic_checks\n    raise Exception(\"Elasticsearch 服务不可用\")\nException: Elasticsearch 服务不可用\n", "stack_info": ["  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py\", line 87, in _run_code\n    exec(code, run_globals)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py\", line 9, in <module>\n    raise SystemExit(pytest.console_main())\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 201, in console_main\n    code = main()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py\", line 175, in main\n    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 330, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 283, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 337, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py\", line 362, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 113, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 132, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 241, in call_and_report\n    call = CallInfo.from_call(\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 533, in runtest\n    super().runtest()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py\", line 1052, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\n    self.run_forever()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 601, in run_forever\n    self._run_once()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py\", line 1905, in _run_once\n    handle._run()\n", "  File \"/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py\", line 107, in test_qa_system\n    qa_logger.log_error(\"异常堆栈信息:\", exc_info=True)\n", "  File \"/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py\", line 102, in log_error\n    error_context[\"stack_info\"] = traceback.extract_stack().format()\n"]}
Traceback (most recent call last):
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 69, in test_qa_system
    self.basic_checks()
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 601, in basic_checks
    raise Exception("Elasticsearch 服务不可用")
Exception: Elasticsearch 服务不可用
Stack (most recent call last):
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 330, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 283, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 337, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/main.py", line 362, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 113, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 132, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 241, in call_and_report
    call = CallInfo.from_call(
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 341, in from_call
    result: TResult | None = func()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 242, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    item.runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 533, in runtest
    super().runtest()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 1627, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_hooks.py", line 513, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pluggy/_callers.py", line 103, in _multicall
    res = hook_impl.function(*args)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/site-packages/pytest_asyncio/plugin.py", line 1052, in inner
    _loop.run_until_complete(task)
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/Users/max.xu/anaconda3/envs/env4LLM/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/tests/test_qa.py", line 107, in test_qa_system
    qa_logger.log_error("异常堆栈信息:", exc_info=True)
  File "/Users/max.xu/Documents/GitHub/pythonProject/LLM/app/utils/logger.py", line 104, in log_error
    self.app_logger.error(
